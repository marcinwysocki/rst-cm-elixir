<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Debugging Elixir in production</title>

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/solarized.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css" />

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = window.location.search.match(/print-pdf/gi)
        ? "css/print/pdf.css"
        : "css/print/paper.css";
      document.getElementsByTagName("head")[0].appendChild(link);
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/elixir.png"
          />

          <aside class="notes">
            <ul>
              <li>Kto korzysta produkcyjnie? Kto hobbystycznie?</li>
              <li>stosunkowo mody - Jose Valim, 2011 rok</li>
              <li>w RST na prod - unikatowa sytuacja</li>
            </ul>
          </aside>
        </section>

        <section>
          <h1></h1>

          <aside class="notes">
            <ul>
              <li>wdra偶anie tak niszowej technologii w projekcie</li>
              <li>jak przekona biznes?</li>
              <li>u nas biznes/architekci przyszli do zespou</li>
              <li>"r贸bcie", no i zrobili</li>
            </ul>
          </aside>
        </section>

        <section>
          <h1 style="font-size: 230px;">Elixir</h1>
          <h2>blaski i cienie</h2>

          <!-- <p style="margin-top: 50px; font-size: 25px;">Marcin Wysocki</p> -->
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/trans4.jpg"
          />

          <aside class="notes">
            <ul>
              <li>RST od wielu lat system Trans.eu</li>
              <li>komunikator integraln czci</li>
              <li>serwer i klient desktopowy w C++</li>
              <li>wasny protok贸 binarny, sporo logiki w kliencie</li>
              <li>10+ lat, dug technologiczny - kosztowny rozw贸j</li>
              <li>problemy ze skalowaniem</li>
            </ul>
          </aside>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/trans6.png"
          />

          <aside class="notes">
            <ul>
              <li>stare - nie po drodze z now platform</li>
              <li>skierowana do innego segmentu rynku</li>
              <li>przywidywany wzrost liczby u偶ytkownik贸w</li>
              <li>integracje z innymi apkami klienckimi (w tym webow)</li>
              <li>nowe funkcjonalnoci - du偶e koszty</li>
            </ul>
          </aside>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;  margin-right: 125px;"
            src="/images/xmpp.png"
          />
          <img
            style="border: none; box-shadow: none;"
            src="/images/ejabberd.png"
          />

          <aside class="notes">
            <ul>
              <li>ejabberd - gotowy serwer XMPP</li>
              <li>pomys wydawa si suszny</li>
              <li>XMPP - otwarty, bogaty i szeroko stosowany protok贸</li>
              <li>ejabberd - ze wstpnych test贸w bardzo wydajne</li>
              <li>integracja z Cpp tricky, ale ejabberd modularne</li>
            </ul>
          </aside>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/elixir.png"
          />
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/notelixir.png"
          />
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/erlang-logo.png"
          />
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/erlang.jpg"
          />

          <aside class="notes">
            <ul>
              <li>cizko nazwa technologi przyszoci</li>
              <li>stworzony w latach 80</li>
              <li>skadnia inspirowana Prologiem</li>
              <li>VM to bardzo ciekawa technologia</li>
            </ul>
          </aside>
        </section>

        <section>
          <div style="font-size: 25px;">
            <pre style="box-shadow: none;">
                                    <code data-trim data-noescape class="erlang">
                    -module(some_erlang_module).
                    
                    -export([map/2]).
                    
                    map(_, []) ->
                        [];
                    map(Func, List) when is_function(Func) andalso is_list(List)  ->
                        do_map([], Func, List);
                    map(_, _) ->
                        erlang:error(badarg).
            
                    do_map(Acc, _, []) ->
                        lists:reverse(Acc);
                    do_map(Acc, Fun, [Head | Tail]) ->
                        Mapped = Fun(Head),
                        do_map([Mapped | Acc], Fun, Tail).
                </code>
            </pre>
            <pre style="box-shadow: none;">
                    <code data-trim data-noescape class="elixir">
                    defmodule SomeElixirModule do
                      def map(_, []), do: []

                      def map(func, list) when is_function(func) and is_list(list), 
                        do: do_map([], func, list)
                      
                      def map(_, _), do:  raise ArgumentError
                      
                      defp do_map(acc, _, []), do: Enum.reverse(acc)
                      
                      defp do_map(acc, func, [head | tail]) do
                        mapped = func.(head)
                        
                        do_map([mapped | acc], func, tail)
                      end
                    end
                    </code></pre>
          </div>

          <aside class="notes">
            <ul>
              <li>Elixir - skadnia inspirowana Rubym na VM Erlanga</li>
              <li>CoffeScript vs JS</li>
              <li>Erlang i Elixir bd stosowa zamiennie</li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Jzyk funkcyjny</h3>
          <pre style="box-shadow: none; font-size: 11px;">
                        <code data-trim data-noescape class="elixir">
                        przykad                       </code></pre>

          <aside class="notes">
            <ul>
              <li>Funkcje zawarte w moduach</li>
              <li>
                Operacje na strukturach danych i wartociach, brak przekazywania
                przez referencj
              </li>
              <li>Pattern matching</li>
              <li>Kompozycja przez pipe</li>
              <li>Pragmatyczny - efekty uboczne</li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Wsp贸bie偶no - model aktorowy</h3>
          <img
            style="border: none; box-shadow: none;"
            src="/images/actors.png"
          />
          <p style="font-size: 0.35em; margin-top: 50px;">
            https://www.brianstorti.com/the-actor-model/
          </p>

          <aside class="notes">
            <ul>
              <li>Aktorzy - "procesy"</li>
              <li>
                VM, nie systemowe; bardzo lekkie, mo偶a tworzy/usuwa atwo
              </li>
              <li>Nie wsp贸dziel pamici</li>
              <li>Wasne GC</li>
              <li>Komunikacja cile przez wiadomoci</li>
              <li>Synchroniczne przetwarzanie wiadomoci</li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Wielowtkowo</h3>
          <pre style="box-shadow: none; font-size: 18px;">

            +--------------------------------------------------------+
            |                                                        |
            |  +-----------------+-----------------+                 |
            |  |                 |                 |                 |
            |  |  Scheduler # 1  |  Run Queue # 1  <--+              |
            |  |                 |                 |  |              |
            |  +-----------------+-----------------+  |              |
            |                                         |              |
            |  +-----------------+-----------------+  |              |
            |  |                 |                 |  |              |
            |  |  Scheduler # 2  |  Run Queue # 2  <----> Migration  |
            |  |                 |                 |  |     Logic    |
            |  +-----------------+-----------------+  |              |
            |                                         |              |
            |  +-----------------+-----------------+  |              |
            |  |                 |                 |  |              |
            |  |  Scheduler # N  |  Run Queue # N  <--+              |
            |  |                 |                 |                 |
            |  +-----------------+-----------------+                 |
            |                                                        |
            +--------------------------------------------------------+
                            </pre
          >

          <p style="font-size: 0.35em; margin-top: 50px;">
            https://hamidreza-s.github.io/erlang/scheduling/real-time/preemptive/migration/2016/02/09/erlang-scheduler-details.html
          </p>

          <aside class="notes">
            <ul>
              <li>VM rozprowadza procesy po wtkach</li>
              <li>
                Round robin, liczenie operacji (procesy nie blokuj wtku)
              </li>
              <li>Logika load balancingu</li>
              <li>U偶ywamy wysokopoziomowych abstrakcji</li>
              <li>Bardzo trudny problem rozwizany za nas</li>
              <li>
                Bardzo du偶a wsp贸bie偶no - setki tysicy, a nawet miliony
                proces贸w na jednej maszynie
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Wydajno</h3>
          <div class="fragment fade-in">
            <img
              style="border: none; box-shadow: none;"
              src="/images/bleacher.png"
            />
            <p style="font-size: 0.35em;">
              https://www.techworld.com/apps-wearables/how-elixir-helped-bleacher-report-handle-8x-more-traffic-3653957/
            </p>
          </div>

          <div class="fragment fade-in">
            <img
              style="border: none; box-shadow: none;"
              src="/images/whatsapp.png"
            />
            <p style="font-size: 0.35em;">
              https://www.wired.com/2015/09/whatsapp-serves-900-million-users-50-engineers/
            </p>
          </div>

          <aside class="notes">
            <ul>
              <li>bardzo du偶o rzeczy na raz, niekoniecznie super szybko</li>
              <li>
                GC per proces, procesy wywaszczane (preemptive scheduling)
              </li>
              <li>dobre do async IO</li>
              <li>kiepskie w obliczeniach, lepszy Cpp, Rust</li>
              <li>wsp贸bie偶no nastawiona na co innego, a mianowicie...</li>
            </ul>
          </aside>
        </section>

        <section>
          <h2>Fault Tolerance</h2>

          <aside class="notes">
            <ul>
              <li>Ericsson - sieci telefoniczne musz dziaa non-stop</li>
              <li>
                dwa aspekty
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Rozej si!</h3>
          <img
            style="border: none; box-shadow: none;"
            src="/images/clustering.png"
          />
          <p style="font-size: 0.35em; margin-top: 50px;">
            https://emqx-enterprise-docs-en.readthedocs.io/en/latest/cluster.html
          </p>

          <aside class="notes">
            <ul>
              <li>
                Odporno na "wycignicie wtyczki" - wicej ni偶 jedna maszyna
              </li>
              <li>
                wszystkie maszyny cz si w klaster za pomoc wasnego
                protokou
              </li>
              <li>mo偶na traktowa jak jedn maszyn</li>
              <li>woanie proces贸w z innego node lokalnie</li>
              <li>remsh</li>
              <li>bezproblemowe skalowanie</li>
              <li>
                Rozproszony system - bardzo trudny problem rozwizany za nas
              </li>
              <li>Mnesia, synchronizacja danych w klastrze</li>
              <li>Czy ten temat koczy si tutaj? (i do problem贸w)</li>
            </ul>
          </aside>
        </section>

        <section>
          <h2>Sia nawyku</h2>

          <div
            style="
            margin-top: 50px;
          display: flex;
          flex-direction: row;
          align-items: stretch;
          font-size: 35px;
          "
          >
            <ul style="flex: 1; list-style-type: none;">
              <li>functional</li>
              <li>message passing</li>
              <li>dynamic typing</li>
            </ul>

            <ul style="flex: 1; list-style-type: none; text-align: center;">
              <li>vs</li>
              <li>vs</li>
              <li>vs</li>
            </ul>

            <ul style="flex: 1; list-style-type: none; text-align: right;">
              <li>OOP</li>
              <li>shared memory</li>
              <li>static typing</li>
            </ul>
          </div>

          <aside class="notes">
            <ul>
              <li>
                przeciwiestwo tego, z czym wikszo developer贸w miao do
                czynienia
              </li>
              <li>zupenie nowy paradygmat; wprowadzenie kosztuje</li>
              <li>
                naturalnie d偶ymy do wykorzystania swoich dowiadcze
                (suszanie)
              </li>
              <li>
                wikszo os贸b sceptycznie podchodzi do nowinek (poniekd te偶
                suszanie)
              </li>
              <li>chcemy rozpocz projekt szybko</li>
              <li>
                wielu developer贸w powiela wzorce z tego co znaj, zamiast
                nauczy si nowej technologii
              </li>
              <li>
                skutki: min. refactor po nabyciu skilla, max. wasny framework
                symulujcy brakujce ficzery, nieutrzymywalne/niedziaajce
              </li>
              <li>przykady: C# -> React, PHP -> Node, PHP -> Erlang</li>
            </ul>
          </aside>
        </section>

        <section>
          <section>
            <h3>Przykad</h3>

            <aside class="notes">
              <ul>
                <li>
                  Problem - zapis ka偶dej przychodzcej wiadomoci do archiwum
                </li>
                <li>Zapis - req HTTP</li>
              </ul>
            </aside>
          </section>

          <section>
            <pre style="box-shadow: none; font-size: 18px; margin-top: 50px;">
        +----------- +          +--------------------+              +-------------+
        |            |          |                    |              |             |
---msg-->   Module   <---save--->   ArchiveService   <---req/resp--->   Archive   |
        |            |          |                    |              |             |
        +----------- +          +--------------------+              +-------------+
          </pre
            >
            <aside class="notes">
              <ul>
                <li>
                  OOP
                  <ul>
                    <li>Modu jest instancj klasy</li>
                    <li>Ma wstrzyknit instacj ArchiveService</li>
                    <li>Wiadomo przychodzi w kontekcie u偶ytkownika</li>
                    <li>ArchiveService strzela do archiwum</li>
                    <li>
                      Wsp贸bie偶no?
                      <ul>
                        <li>Brak (PHP)</li>
                        <li>
                          Ka偶da wiadomo w osobnym wtku lub wtek per
                          u偶ytkownik
                        </li>
                        <li>Promise/async</li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li>
                  Erlang

                  <ul>
                    <li>Modu jest... moduem, zawiera callbacki</li>
                    <li>
                      S one wywoywane z wiadomoci i kontekstem u偶ytkownika
                    </li>
                    <li>
                      ArchiveService to proces (GenServer) - przechowuje lokalny
                      stan, podobnie jak obiekt
                    </li>
                  </ul>
                </li>
              </ul>
            </aside>
          </section>
        </section>

        <section>
          <h3>Problem</h3>

          <img
            style="border: none; box-shadow: none;"
            src="/images/msg-match.png"
          />
          <p style="font-size: 0.35em; margin-top: 50px;">
            https://learnyousomeerlang.com/more-on-multiprocessing
          </p>

          <aside class="notes">
            <ul>
              <li>
                To rozwizanie okazuje si bardzo niewydajne
              </li>
              <li>Wsp贸bie偶no nie jest wykorzystana wcale</li>
              <li>
                Message passing - kolejka wiadomoci na ArchiveService ronie
              </li>
              <li>Przeci偶enie systemu</li>
              <li>Typowy bd pocztkujcego (i nie tylko)</li>
              <li>
                Skutki - system nieresponsywny przy ok. 5% wymaganego obci偶enia
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Rozwizanie</h3>

          <img
            style="border: none; box-shadow: none;"
            src="/images/ranch.jpg"
          />
          <p style="font-size: 0.35em; margin-top: 50px;">
            http://learningelixir.joekain.com/ranch-application-design/
          </p>

          <aside class="notes">
            <ul>
              <li>
                Pula proces贸w
              </li>
              <li>
                Zaleta - limitowanie maksymalnej jednoczesnej liczby request贸w
              </li>
              <li>
                Pula te偶 jest procesem, ale pobiera on tylko PIDy worker贸w
              </li>
              <li>Mo偶e zosta przeci偶ona - powr贸t do problemu</li>
              <li>Wtedy konieczne jest zarzdzanie kolejk wiadomoci</li>
              <li>Generalnie bardzo du偶o kolejek</li>
            </ul>
          </aside>
        </section>

        <section>
          <h2>Jak tego unikn?</h2>
          <h2 class="fragment fade-in" style="margin-top: 50px;">
            Pozna podstawy!
          </h2>

          <aside class="notes">
            <ul>
              <li>
                Podstawowe koncepcje, nowy paradygmat
              </li>
              <li>Konwencje</li>
              <li>
                Wzorce
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <h1>Thanks!</h1>

          <p>Marcin Wysocki</p>
          <p><a href="mailto:wysocki@undef.pl">wysocki@undef.pl</a></p>
        </section>
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        transition: "convex",
        dependencies: [
          { src: "plugin/markdown/marked.js" },
          { src: "plugin/markdown/markdown.js" },
          { src: "plugin/notes/notes.js", async: true },
          { src: "plugin/highlight/highlight.js", async: true }
        ]
      });
    </script>
  </body>
</html>
