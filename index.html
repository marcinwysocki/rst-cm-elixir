<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Debugging Elixir in production</title>

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/solarized.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css" />

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = window.location.search.match(/print-pdf/gi)
        ? "css/print/pdf.css"
        : "css/print/paper.css";
      document.getElementsByTagName("head")[0].appendChild(link);
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/elixir.png"
          />

          <aside class="notes">
            <ul>
              <li>Kto korzysta produkcyjnie? Kto hobbystycznie?</li>
              <li>stosunkowo młody - Jose Valim, 2011 rok</li>
              <li>w RST na prod - unikatowa sytuacja</li>
            </ul>
          </aside>
        </section>

        <section>
          <h1>Jakiś obrazek pod chęć wdrożenie nowej technologii 🤔</h1>

          <aside class="notes">
            <ul>
              <li>wdrażanie tak niszowej technologii w projekcie</li>
              <li>jak przekonać biznes?</li>
              <li>u nas biznes/architekci przyszli do zespołu</li>
              <li>"róbcie", no i zrobili</li>
            </ul>
          </aside>
        </section>

        <section>
          <h1>Elixir - blaski i cienie</h1>

          <p>Marcin Wysocki</p>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/trans4.jpg"
          />

          <aside class="notes">
            <ul>
              <li>RST od wielu lat system Trans.eu</li>
              <li>komunikator integralną częścią</li>
              <li>serwer i klient desktopowy w C++</li>
              <li>własny protokół binarny, sporo logiki w kliencie</li>
              <li>10+ lat, dług technologiczny - kosztowny rozwój</li>
              <li>problemy ze skalowaniem</li>
            </ul>
          </aside>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/trans6.png"
          />

          <aside class="notes">
            <ul>
              <li>stare - nie po drodze z nową platformą</li>
              <li>skierowana do innego segmentu rynku</li>
              <li>przywidywany wzrost liczby użytkowników</li>
              <li>integracje z innymi apkami klienckimi (w tym webową)</li>
              <li>nowe funkcjonalności - duże koszty</li>
            </ul>
          </aside>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;  margin-right: 125px;"
            src="/images/xmpp.png"
          />
          <img
            style="border: none; box-shadow: none;"
            src="/images/ejabberd.png"
          />

          <aside class="notes">
            <ul>
              <li>ejabberd - gotowy serwer XMPP</li>
              <li>pomysł wydawał się słuszny</li>
              <li>XMPP - otwarty, bogaty i szeroko stosowany protokół</li>
              <li>ejabberd - ze wstępnych testów bardzo wydajne</li>
              <li>integracja z Cpp tricky, ale ejabberd modularne</li>
            </ul>
          </aside>
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/elixir.png"
          />
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/notelixir.png"
          />
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/erlang-logo.png"
          />
        </section>

        <section>
          <img
            style="border: none; box-shadow: none;"
            src="/images/erlang.jpg"
          />

          <aside class="notes">
            <ul>
              <li>cięzko nazwać technologią przyszłości</li>
              <li>stworzony w latach 80</li>
              <li>składnia inspirowana Prologiem</li>
              <li>VM to bardzo ciekawa technologia</li>
            </ul>
          </aside>
        </section>

        <section>
          <div style="display: flex; flex-direction: row;">
            <pre style="box-shadow: none; font-size: 11px;">
                                    <code data-trim data-noescape class="erlang">
                    -module(some_erlang_module).
                    
                    -export([map/2]).
                    
                    map(_, []) ->
                        [];
                    map(Func, List) when is_function(Func) andalso is_list(List)  ->
                        do_map([], Func, List);
                    map(_, _) ->
                        erlang:error(badarg).
            
                    do_map(Acc, _, []) ->
                        lists:reverse(Acc);
                    do_map(Acc, Fun, [Head | Tail]) ->
                        Mapped = Fun(Head),
                        do_map([Mapped | Acc], Fun, Tail).
                </code>
            </pre>
            <pre style="box-shadow: none; font-size: 11px;">
                    <code data-trim data-noescape class="elixir">
                    defmodule SomeElixirModule do
                      def map(_, []), do: []
                      def map(func, list) when is_function(func) and is_list(list), do: do_map([], func, list)
                      def map(_, _), do:  raise ArgumentError
                      
                      defp do_map(acc, _, []), do: Enum.reverse(acc)
                      
                      defp do_map(acc, func, [head | tail]) do
                        mapped = func.(head)
                        
                        do_map([mapped | acc], func, tail)
                      end
                    end
                    </code></pre>
          </div>

          <aside class="notes">
            <ul>
              <li>Elixir - składnia inspirowana Rubym na VM Erlanga</li>
              <li>CoffeScript vs JS</li>
              <li>Erlang i Elixir będę stosował zamiennie</li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Język funkcyjny</h3>
          <pre style="box-shadow: none; font-size: 11px;">
                        <code data-trim data-noescape class="elixir">
                        przykład                       </code></pre>

          <aside class="notes">
            <ul>
              <li>Funkcje zawarte w modułach</li>
              <li>
                Operacje na strukturach danych i wartościach, brak przekazywania
                przez referencję
              </li>
              <li>Pattern matching</li>
              <li>Kompozycja przez pipe</li>
              <li>Pragmatyczny - efekty uboczne</li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Współbieżność - model aktorowy</h3>
          <img
            style="border: none; box-shadow: none;"
            src="/images/actors.png"
          />
          <p style="font-size: 0.35em; margin-top: 50px;">
            https://www.brianstorti.com/the-actor-model/
          </p>

          <aside class="notes">
            <ul>
              <li>Aktorzy - "procesy"</li>
              <li>
                VM, nie systemowe; bardzo lekkie, moża tworzyć/usuwać łatwo
              </li>
              <li>Nie współdzielą pamięci</li>
              <li>Własne GC</li>
              <li>Komunikacja ściśle przez wiadomości</li>
              <li>Synchroniczne przetwarzanie wiadomości</li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Wielowątkowość</h3>
          <pre style="box-shadow: none; font-size: 18px;">

            +--------------------------------------------------------+
            |                                                        |
            |  +-----------------+-----------------+                 |
            |  |                 |                 |                 |
            |  |  Scheduler # 1  |  Run Queue # 1  <--+              |
            |  |                 |                 |  |              |
            |  +-----------------+-----------------+  |              |
            |                                         |              |
            |  +-----------------+-----------------+  |              |
            |  |                 |                 |  |              |
            |  |  Scheduler # 2  |  Run Queue # 2  <----> Migration  |
            |  |                 |                 |  |     Logic    |
            |  +-----------------+-----------------+  |              |
            |                                         |              |
            |  +-----------------+-----------------+  |              |
            |  |                 |                 |  |              |
            |  |  Scheduler # N  |  Run Queue # N  <--+              |
            |  |                 |                 |                 |
            |  +-----------------+-----------------+                 |
            |                                                        |
            +--------------------------------------------------------+
                            </pre
          >

          <p style="font-size: 0.35em; margin-top: 50px;">
            https://hamidreza-s.github.io/erlang/scheduling/real-time/preemptive/migration/2016/02/09/erlang-scheduler-details.html
          </p>

          <aside class="notes">
            <ul>
              <li>VM rozprowadza procesy po wątkach</li>
              <li>
                Round robin, liczenie operacji (procesy nie blokują wątku)
              </li>
              <li>Logika load balancingu</li>
              <li>Używamy wysokopoziomowych abstrakcji</li>
              <li>Bardzo trudny problem rozwiązany za nas</li>
              <li>
                Bardzo duża współbieżność - setki tysięcy, a nawet miliony
                procesów na jednej maszynie
              </li>
            </ul>
          </aside>
        </section>

        <section>
          <h3>Rozejść się!</h3>
          <img
            style="border: none; box-shadow: none;"
            src="/images/clustering.png"
          />
          <p style="font-size: 0.35em; margin-top: 50px;">
            https://emqx-enterprise-docs-en.readthedocs.io/en/latest/cluster.html
          </p>

          <aside class="notes">
            <ul>
              <li></li>
            </ul>
          </aside>
        </section>

        <section>
          <h1>Thanks!</h1>

          <p>Marcin Wysocki</p>
          <p><a href="mailto:wysocki@undef.pl">wysocki@undef.pl</a></p>
        </section>
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        transition: "convex",
        dependencies: [
          { src: "plugin/markdown/marked.js" },
          { src: "plugin/markdown/markdown.js" },
          { src: "plugin/notes/notes.js", async: true },
          { src: "plugin/highlight/highlight.js", async: true }
        ]
      });
    </script>
  </body>
</html>
